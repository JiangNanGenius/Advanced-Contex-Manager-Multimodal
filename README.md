# ğŸš€ é«˜çº§ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆå¤šæ¨¡æ€ + ä¸Šä¸‹æ–‡æœ€å¤§åŒ–ï¼‰+ è‡ªåŠ¨è®°å¿†ï¼ˆåå°ï¼‰ - v2.6.2

**author**: JiangNanGenius  
**version**: 2.6.2  
**license**: MIT  
**required_open_webui_version**: 0.5.17  
**Github**: https://github.com/JiangNanGenius  

> ç›®æ ‡ï¼šåœ¨**ä¸ç‰ºç‰²å…³é”®å†…å®¹**çš„å‰æä¸‹ï¼Œå°½å¯èƒ½æŠŠå¯¹è¯å†å²å¡è¿›æ¨¡å‹ä¸Šä¸‹æ–‡ï¼ˆCoverage-First / Chunking / Summarizationï¼‰ï¼Œå¹¶æ”¯æŒ**å¤šæ¨¡æ€å›¾ç‰‡é¢„å¤„ç†è½¬å†™**ï¼›åŒæ—¶æä¾›**è‡ªåŠ¨è®°å¿†ï¼ˆAuto Memoryï¼‰**èƒ½åŠ›ï¼Œé»˜è®¤åå°è¿è¡Œã€å°½é‡ä¸æ‰“æ‰°å‰å°ã€‚

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§ï¼ˆv2.6.2ï¼‰

### 1) ä¸Šä¸‹æ–‡æœ€å¤§åŒ–ï¼ˆContext Maximizationï¼‰
- **Coverage-First**ï¼šæŠŠå†å²æ¶ˆæ¯æŒ‰ç›¸å…³åº¦åˆ†ä¸ºé«˜/ä¸­/ä½ä¼˜å…ˆçº§  
  - é«˜/ä¸­ä¼˜å…ˆçº§ â†’ å¾®æ‘˜è¦ï¼ˆmicro summaryï¼‰  
  - ä½ä¼˜å…ˆçº§ â†’ è‡ªé€‚åº”åˆ†å—æ‘˜è¦ï¼ˆadaptive block summaryï¼‰  
  - æç«¯è¶…é™ â†’ å…¨å±€å—æ‘˜è¦ï¼ˆglobal block fallbackï¼‰
- **ä¸æˆªæ–­ä¿éšœï¼ˆZero-Loss Guarantee æ€è·¯ï¼‰**
  - å¤šè½®é¢„ç®—è°ƒæ•´
  - æœ€å°æ‘˜è¦é¢„ç®—å…œåº•
  - é¿å…â€œä¿é™©æˆªæ–­â€å¯¼è‡´å†…å®¹ç›´æ¥è¢«ç¡¬è£æ‰ï¼ˆå¯é…ç½®ï¼‰

### 2) æ™ºèƒ½åˆ†ç‰‡ï¼ˆChunkingï¼‰
- å¯¹è¶…é•¿å•æ¡æ¶ˆæ¯è¿›è¡Œ**æ®µè½çº§æ™ºèƒ½åˆ‡å—**ï¼ˆå¯é…ç½® overlapï¼‰
- ä¸ºæ¯æ¡æ¶ˆæ¯ç”Ÿæˆç¨³å®š `_order_id`ï¼Œåˆ‡å—åç”Ÿæˆ `msg_id#chunk_index`
- ç›®æ ‡ï¼šå‡å°‘â€œå•æ¡æ¶ˆæ¯è¿‡å¤§å¯¼è‡´æ•´ä½“è¶…é™/æ‘˜è¦è´¨é‡å˜å·®â€çš„æƒ…å†µ

### 3) å¤šæ¨¡æ€ï¼ˆå›¾ç‰‡å¤„ç† & å…¼å®¹éå¤šæ¨¡æ€æ¨¡å‹ï¼‰
- å¦‚æœå†å²æ¶ˆæ¯/å½“å‰æ¶ˆæ¯åŒ…å«å›¾ç‰‡ï¼š  
  - å¤šæ¨¡æ€æ¨¡å‹ï¼šå¯é€‰æ‹©ä¿ç•™åŸå›¾æˆ–å…ˆè½¬å†™åæ‘˜è¦  
  - éå¤šæ¨¡æ€æ¨¡å‹ï¼šè‡ªåŠ¨æ‰§è¡Œå›¾ç‰‡è½¬å†™ï¼ˆVision Prompt æ¨¡æ¿å¯é…ç½®ï¼‰ï¼Œé¿å…æ¨¡å‹ä¸æ”¯æŒå›¾è¾“å…¥å¯¼è‡´å¤±è´¥

### 4) å‘é‡æ£€ç´¢ + é‡æ’åºï¼ˆå¯å¼€å…³ï¼‰
- æ”¯æŒå¯¹å†å²æ¶ˆæ¯åš embeddingï¼Œç›¸ä¼¼åº¦å¬å›
- æ”¯æŒ rerankï¼ˆé‡æ’åºï¼‰è¿›ä¸€æ­¥ç­›é€‰é«˜ä»·å€¼å†…å®¹
- å†…ç½® embedding cacheï¼ˆæŒ‰ content_key ç¼“å­˜ï¼‰ï¼Œå‡å°‘é‡å¤è¯·æ±‚

### 5) è‡ªåŠ¨è®°å¿†ï¼ˆAuto Memoryï¼‰
- è‡ªåŠ¨ä»æœ€è¿‘å¯¹è¯ä¸­æå–â€œé€‚åˆé•¿æœŸè®°ä½â€çš„äº‹å®/åå¥½/çº¦æŸ
- æ”¯æŒ **å¼ºåˆ¶è®°å¿†å‰ç¼€**ï¼šå¦‚ `è®°ä½:` / `remember:` å‘½ä¸­åˆ™ç›´æ¥å†™å…¥ï¼Œä¸èµ° LLM åˆ¤æ–­
- å¯¹ OpenWebUI Memory å¸¸è§ **404 â€œNo memories foundâ€** åšäº†å…¼å®¹ï¼šè¡¨ç¤ºâ€œå½“å‰æ²¡æœ‰è®°å¿†â€ï¼Œä¸æ˜¯åŠŸèƒ½åäº†

---

## âœ… é€‚ç”¨åœºæ™¯
- å¯¹è¯å˜é•¿ â†’ æ¨¡å‹å¼€å§‹ä¸¢ä¸Šä¸‹æ–‡ / ç­”éæ‰€é—®
- æœ‰å›¾ç‰‡ï¼ˆæˆªå›¾ã€æ—¥å¿—ã€é…ç½®ï¼‰â†’ æƒ³è‡ªåŠ¨è½¬å†™å¹¶å‚ä¸æ£€ç´¢/æ‘˜è¦
- æƒ³è¦â€œè‡ªåŠ¨è®°å¿†â€ç”¨æˆ·åå¥½/é•¿æœŸé¡¹ç›®ï¼Œä½†ä¸æƒ³æ¯æ¬¡æ‰‹åŠ¨ç»´æŠ¤
- ä½¿ç”¨å¤šä¸ªæ¨¡å‹ï¼ˆGPT/Claude/Qwen/GLM/è±†åŒ…/æ–‡å¿ƒç­‰ï¼‰å¸Œæœ›è‡ªåŠ¨é€‚é…ä¸Šä¸‹æ–‡ç­–ç•¥

---

## ğŸ“¦ ä¾èµ–ä¸è¦æ±‚

### Open WebUI
- `>= 0.5.17`

### Python ä¾èµ–ï¼ˆå¯é€‰ä½†å»ºè®®ï¼‰
- `openai`ï¼ˆOpenAI-compatible APIï¼Œä»£ç ä½¿ç”¨ `AsyncOpenAI`ï¼‰
- `tiktoken`ï¼ˆæ›´å‡† token ä¼°ç®—ï¼›ç¼ºå¤±ä¼šé™çº§ä¸ºç²—ç•¥ä¼°ç®—ï¼‰
- `httpx`ï¼ˆå¦‚ä½ æ‰©å±•ç½‘ç»œè°ƒç”¨ï¼‰

> æ²¡è£… `tiktoken` ä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯ token è®¡ç®—ä¼šæ›´ç²—ç³™ï¼ˆæŒ‰å­—ç¬¦/4ä¼°ç®—ï¼‰ã€‚

---

## ğŸ› ï¸ å®‰è£…æ–¹å¼

> ä½ åªè¦æŠŠè¿™ä¸ª `.py` æ”¾åˆ° **OpenWebUI èƒ½åŠ è½½ Filter çš„ç›®å½•**å³å¯ï¼ˆå¸¸è§æ˜¯ `open_webui/filters/` ä¸€ç±»è·¯å¾„ï¼‰ï¼Œç„¶åé‡å¯ã€‚

### æ–¹å¼ Aï¼šDockerï¼ˆæ¨èï¼‰
1. æ‰¾åˆ°å®¹å™¨å†… Open WebUI åç«¯ä»£ç ç›®å½•ï¼ˆå¸¸è§ `/app/backend/open_webui/`ï¼‰
2. æŠŠæœ¬æ–‡ä»¶ä¿å­˜ä¸ºä¾‹å¦‚ï¼š`advanced_context_manager_v262.py`
3. æŒ‚è½½åˆ°å®¹å™¨å†… filters ç›®å½•ï¼ˆç¤ºä¾‹ï¼‰ï¼š
   ```bash
   -v ./filters:/app/backend/open_webui/filters
   ```
4. é‡å¯å®¹å™¨

ä¸çŸ¥é“ç›®å½•ï¼Ÿè¿›å®¹å™¨æ‰§è¡Œï¼š
```bash
find /app -maxdepth 4 -type d -name "filters"
```

### æ–¹å¼ Bï¼šé Docker / æºç éƒ¨ç½²
1. æŠŠæ–‡ä»¶å¤åˆ¶åˆ° Open WebUI åç«¯çš„ filters ç›®å½•
2. é‡å¯åç«¯æœåŠ¡

---

## âš™ï¸ é…ç½®è¯´æ˜ï¼ˆValvesï¼‰

å®é™…ä½¿ç”¨å»ºè®®å…ˆåªåŠ¨â€œæœ€å½±å“æ•ˆæœâ€çš„ã€‚

### 1) å¿…å¡«ï¼šAPI é…ç½®
- `api_base`ï¼šOpenAI-compatible base url
- `api_key`ï¼šä½ çš„ keyï¼ˆå¿…å¡«ï¼‰

### 2) æ¨¡å‹é…ç½®
- `multimodal_model`ï¼šå¤šæ¨¡æ€æ¨¡å‹ï¼ˆç”¨äºå›¾ç‰‡è½¬å†™/å¤šæ¨¡æ€æ‘˜è¦ï¼‰
- `text_model`ï¼šæ–‡æœ¬æ¨¡å‹ï¼ˆç”¨äºæ‘˜è¦ã€å…³é”®è¯ã€æ£€æµ‹ç­‰ï¼‰
- `memory_model`ï¼šè‡ªåŠ¨è®°å¿†æ¨¡å‹
- `text_vector_model`ï¼šæ–‡æœ¬å‘é‡æ¨¡å‹
- `multimodal_vector_model`ï¼šå¤šæ¨¡æ€å‘é‡æ¨¡å‹

### 3) å‰å°å®‰é™è¿è¡Œ
- `suppress_frontend_when_idle = true`
- `show_frontend_progress = false`
- `enable_detailed_progress = false`

### 4) ä¸Šä¸‹æ–‡æœ€å¤§åŒ–ç­–ç•¥å¼€å…³
- `enable_processing`
- `enable_context_maximization`
- `enable_coverage_first`
- `enable_zero_loss_guarantee`

### 5) æ€§èƒ½ä¸å¹¶å‘
- `max_concurrent_requests`
- `request_timeout`
- `enable_embedding_cache` + `cache_max_size`

### 6) è‡ªåŠ¨è®°å¿†
- `enable_auto_memory = true`
- `memory_force_add_prefixes = "è®°ä½:;remember:"`
- `memory_related_memories_n`
- `memory_messages_to_consider`

---

## âœ… æœ€å°å¯ç”¨é…ç½®èŒƒä¾‹

```python
api_base = "https://your-openai-compatible-endpoint/v1"
api_key  = "YOUR_KEY"

text_model = "your-text-model"
multimodal_model = "your-vision-model"
memory_model = "your-text-model"

text_vector_model = "your-embedding-model"
multimodal_vector_model = "your-vision-embedding-model"
```

---

## ğŸ§  å·¥ä½œåŸç†ï¼ˆç®€åŒ–æµç¨‹ï¼‰

1. è¯†åˆ«æ¨¡å‹çª—å£ï¼ˆModelMatcherï¼‰+ token ä¼°ç®—ï¼ˆTokenCalculatorï¼‰  
2. æ‹†åˆ†å½“å‰æ¶ˆæ¯ä¸å†å²æ¶ˆæ¯ï¼Œä¿æŠ¤å½“å‰æ¶ˆæ¯  
3. åˆ¤æ–­æ˜¯å¦éœ€è¦å¤„ç†ï¼ˆè¶…é™ / å›¾ç‰‡ä¸å…¼å®¹ï¼‰  
4. å¤§æ¶ˆæ¯åˆ‡å—ï¼ˆMessageChunkerï¼‰  
5. å¬å›ä¸ç›¸å…³åº¦ï¼ˆembedding + rerank å¯é€‰ï¼‰  
6. Coverage è§„åˆ’ï¼ˆé«˜/ä¸­å¾®æ‘˜è¦ï¼Œä½åˆ†å—æ‘˜è¦ï¼Œè¶…é™å…œåº•ï¼‰  
7. å¹¶å‘ç”Ÿæˆæ‘˜è¦å¹¶ç»„è£…è¾“å‡º  
8. Auto Memory ç‹¬ç«‹æµç¨‹ï¼ˆæ— è®°å¿† 404 è§†ä¸ºæ­£å¸¸ï¼‰

---

## ğŸ§¯ å¸¸è§é—®é¢˜

### Memory 404ï¼š`No memories found for user`
âœ… æ­£å¸¸ï¼Œè¡¨ç¤ºâ€œå½“å‰æ²¡æœ‰ä»»ä½•å¯æ£€ç´¢è®°å¿†â€ã€‚

### Auto Memory actions=0ï¼ˆæ²¡å†™è¿›å»ï¼‰
æ£€æŸ¥ï¼š
- `enable_auto_memory = true`
- `api_key/api_base` æ˜¯å¦å¯ç”¨
- å†…å®¹æ˜¯å¦é€‚åˆé•¿æœŸè®°å¿†ï¼ˆåå¥½/é•¿æœŸé¡¹ç›®/å›ºå®šçº¦æŸï¼‰

å¼ºåˆ¶å†™å…¥ï¼šç›´æ¥å‘ï¼š
- `è®°ä½: ...`
- `remember: ...`

### token ä¼°ç®—ä¸å‡†
å»ºè®®å®‰è£… `tiktoken`ã€‚

### å¤ªæ…¢/è¯·æ±‚å¤ªå¤š
é™ä½ï¼š
- `vector_top_k`
- `max_concurrent_requests`
- å…³é—­ `enable_reranking`
- æ‰“å¼€ `enable_embedding_cache`

---

## ğŸ”’ å®‰å…¨å»ºè®®
- ä¸è¦æŠŠ `api_key` æäº¤åˆ°å…¬å¼€ä»“åº“
- å»ºè®®ç”¨ç¯å¢ƒå˜é‡æˆ– OpenWebUI çš„ Secret/é…ç½®é¢æ¿æ³¨å…¥
- è‹¥ä½¿ç”¨ä»£ç†ç½‘å…³ï¼Œå»ºè®®åŠ é‰´æƒ/é™æµ

---

## ğŸ“„ License
MIT
